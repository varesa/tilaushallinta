<!--!
# This source code is licensed under the terms of the Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License.
# To view a copy of this license, visit http://creativecommons.org/licenses/by-nc-sa/4.0/.
# Copyright Esa Varemo 2014-2015
-->

<metal:main metal:use-macro="load: ../master.pt">
    <metal:main metal:fill-slot="title">Tilauksen tiedot</metal:main>

    <metal:main metal:fill-slot="head_custom">
        <link rel="stylesheet" type="text/css" href="/static/css/lomake.css">
        <link rel="stylesheet" type="text/css" href="/static/css/order_details.css">
        <link rel="stylesheet" type="text/css" href="/static/css/order_list.css">

        <script type="text/javascript" src="/static/js/order_state.js"></script>
        <script type="text/javascript" src="/static/js/order_edit_tilaaja_kohde.js"></script>
    </metal:main>

    <metal:main metal:fill-slot="content">
        <div class="panel panel-default" id="perustiedot">
            <div class="panel-body">
                <div id="table_top">
                    <div id="table_title"><h2>Perustiedot<a style="font-size: 10pt;" data-toggle="collapse" href="#table_perustiedot">&nbsp;&nbsp;&nbsp;Näytä/Piilota</a>
                    &nbsp;&nbsp;&nbsp;&nbsp<span style="font-size: 15pt;">${huoltosopimus.kohde.osoite}, ${huoltosopimus.kohde.postinumero}, ${huoltosopimus.kohde.postitoimipaikka}</span></h2></div>
                    <div id="order_actionbuttons">
                        Tila:
                        <select id="state_select" onclick="state_changed()">
                            <option selected="${'selected' if huoltosopimus.tila == huoltosopimus.TILA_ACTIVE else None}" value="${huoltosopimus.TILA_ACTIVE}">Aktiivinen</option>
                            <option selected="${'selected' if huoltosopimus.tila == huoltosopimus.TILA_INACTIVE else None}" value="${huoltosopimus.TILA_INACTIVE}">Inaktiivinen</option>
                        </select>
                        <input type="hidden" name="state_original" value="${huoltosopimus.tila}">
                        <input id="state_change" type="button" value="Vaihda" onclick="huoltosopimus_change_state()" disabled>
                    </div>
                </div>
                <table class="table_lomake collapse in" id="table_perustiedot">
                    <form method="post">
                        <input type="hidden" name="data" value="perustiedot">

                        <input type="hidden" name="tilaaja_id" value="${huoltosopimus.tilaaja.id}">
                        <input type="hidden" name="kohde_id" value="${huoltosopimus.kohde.id}">
                        <input type="hidden" name="huoltosopimus_id" value="${huoltosopimus.id}"> <!-- also used by js:huoltosopimus_change_state() -->

                        <tr>
                            <td>
                                <span class="colheader-left">Laskutus</span><span class="colheader-sub-right">
                                        <a id="tilaaja_muokkaa" onclick="order_muokkaa('tilaaja')">Muokkaa</a></span>
                            </td>
                            <td>
                                <span class="colheader-left">Työ</span><span class="colheader-sub-right">
                                        <a id="kohde_muokkaa" onclick="order_muokkaa('kohde')">Muokkaa</a></span>
                            </td>
                        </tr>
                        <tr>
                            <?python tilaus=huoltosopimus ?>
                            <td><metal:main tal:define="readonly True; compact True"
                                    metal:use-macro="load: ../snippets/tilaaja_panel.pt"></metal:main></td>
                            <td><metal:main tal:define="readonly True; compact True"
                                    metal:use-macro="load: ../snippets/kohde_panel.pt"></metal:main></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>Sähköiset laskutustiedot:<textarea name="kohde_slaskutus" readonly>${huoltosopimus.kohde.slaskutus}</textarea></td>
                        </tr>
                        <tr>
                            <td colspan="2">
                                Muut yhteyshenkilöt:<br>
                                <textarea name="muut_yhteysh">${huoltosopimus.muut_yhteysh}</textarea>
                            </td>
                        </tr>
                        <tr>
                            <td><input type="reset" value="Kumoa"><td><input type="submit" value="Päivitä"></td></td>
                        </tr>
                    </form>
                </table>
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-body">
                <span>Tilatut huollot:</span>
                <ul>
                    <li tal:condition="huoltosopimus.tyyppi_ke"> Keväthuolto</li>
                    <li tal:condition="huoltosopimus.tyyppi_sy"> Syyshuolto</li>
                    <?python import datetime ?>
                    <li tal:condition="huoltosopimus.tyyppi_tk"> Tarkastuskäynnit
                            ${int(huoltosopimus.tk_interval_months) \
                                    if int(huoltosopimus.tk_interval_months) == huoltosopimus.tk_interval_months \
                                    else huoltosopimus.tk_interval_months} kk välein,
                        alkaen ${datetime.datetime.strftime(huoltosopimus.tk_starting_date,"%d.%m.%Y")}</li>
                </ul>
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-body">
                <div id="table_top">
                    <div id="table_title"><h2>Huollot</h2></div>
                    <div id="order_actionbuttons">
                        <button onClick="window.location.href='/huoltosopimukset/${huoltosopimus.id}/huolto/uusi/ek'">Ensimmäinen huolto</button>
                        <button onClick="window.location.href='/huoltosopimukset/${huoltosopimus.id}/huolto/uusi/ke'">Uusi Keväthuolto</button>
                        <button onClick="window.location.href='/huoltosopimukset/${huoltosopimus.id}/huolto/uusi/sy'">Uusi Syyshuolto</button>
                        <button onClick="window.location.href='/huoltosopimukset/${huoltosopimus.id}/huolto/uusi/tk'">Uusi Tarkastuskäynti</button>
                    </div>
                </div>
                <div class="panel">
                    <table metal:use-macro="load: ../snippets/huoltosopimus_huollot_table.pt" tal:define="huollot huoltosopimus.huollot"></table>
                </div>
            </div>
        </div>
    </metal:main>
</metal:main>
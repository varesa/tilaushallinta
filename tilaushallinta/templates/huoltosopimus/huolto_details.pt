<!--!
# This source code is licensed under the terms of the Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License.
# To view a copy of this license, visit http://creativecommons.org/licenses/by-nc-sa/4.0/.
# Copyright Esa Varemo 2014-2015
-->

<metal:main metal:use-macro="load: ../master.pt">
    <metal:main metal:fill-slot="title">Tilauksen tiedot</metal:main>

    <metal:main metal:fill-slot="head_custom">
        <link rel="stylesheet" type="text/css" href="/static/css/lomake.css">
        <link rel="stylesheet" type="text/css" href="/static/css/order_details.css">
        <script type="text/javascript" src="/static/js/order_state.js"></script>
        <script type="text/javascript" src="/static/js/order_edit_tilaaja_kohde.js"></script>
    </metal:main>

    <metal:main metal:fill-slot="content">
        <div class="panel panel-default">
            <div class="panel-body">
                <div id="table_top">
                    <div id="table_title"><h2>Huolto</h2></div>
                    <div id="order_actionbuttons">
                        <!--<button onclick="window.open('/tilaukset/${huolto.id}/yhteenveto');">Näytä yhteenveto</button>&nbsp;&nbsp;&nbsp;&nbsp;-->
                        Tila:
                        <select id="state_select" onclick="state_changed()">
                            <option selected="${'selected' if huolto.tila == 'UUSI' else None}" value="UUSI">Uusi</option>
                            <option selected="${'selected' if huolto.tila == 'ALOITETTU' else None}" value="ALOITETTU">Aloitettu</option>
                            <option selected="${'selected' if huolto.tila == 'VALMIS' else None}" value="VALMIS">Valmis</option>
                        </select>
                        <input type="hidden" name="huolto_id" value="${huolto.id}">
                        <input type="hidden" name="state_original" value="${huolto.tila}">
                        <input id="state_change" type="button" value="Vaihda" onclick="huolto_change_state()" disabled>
                    </div>
                </div>

            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-body">
                <h3>Huoltoraportit</h3>
                <a name="paivaraportit"></a>
                <table class="table" id="table_paivaraportit">
                    <form method="post" action="#paivaraportit">
                        <?python
                            from operator import attrgetter
                        ?>
                        <tal tal:repeat="raportti sorted(huolto.huoltoraportit, key=attrgetter('date'), reverse=False)">
                            <tr class="paivaraportit_dateline">
                                <td colspan="2">${raportti.date.strftime("%d.%m.%Y %H:%M")}</td>
                            </tr>
                            <tr class="paivaraportit_detailsline">
                                <td class="raportti_col1"><textarea name="${raportti.id}-teksti" rows="4">${raportti.teksti}</textarea></td>
                                <td class="raportti_col2">
                                    <table>
                                        <tr>
                                            <td>Hintaluokka:&nbsp;</td>
                                            <td>
                                                <select name="${raportti.id}-hintaluokka">
                                                    <option selected="${'selected' if raportti.hintaluokka == 1 else None}">1</option>
                                                    <option selected="${'selected' if raportti.hintaluokka == 2 else None}">2</option>
                                                    <option selected="${'selected' if raportti.hintaluokka == 3 else None}">3</option>
                                                </select>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Tunnit:&nbsp;</td><td><input name="${raportti.id}-tunnit" value="${raportti.tunnit}"></td>
                                        </tr>
                                        <tr>
                                            <td>Matkat:&nbsp;</td><td><input name="${raportti.id}-matkat" value="${raportti.matkat}"></td>
                                        </tr>
                                        <tr>
                                            <td>Muut:&nbsp;</td><td><input name="${raportti.id}-muut" value="${raportti.muut}"></td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                        </tal>
                        <input type="hidden" name="data" value="paivaraportti">
                        <tr>
                            <td>
                                <input type="submit" name="save" value="Tallenna">
                            </td>
                            <td>
                                <input type="submit" name="add" value="Lisää">
                            </td>
                        </tr>
                    </form>
                </table>
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-body">
                <h3>Laitteet</h3>
                <form method="post" action="#tavarat">
                    <input type="hidden" name="data" value="tavarat">
                    <table class="table" id="table_tavarat">
                        <tr>
                            <th>Koodi</th>
                            <th>Nimike</th>
                            <th>Hinta</th>
                            <th>Määrä</th>
                            <th>Yksikkö</th>
                            <th>A</th>
                            <th>T</th>
                        </tr>
                        <tr tal:repeat="laite huolto.laiteluettelo">
                            <td class="tavara_col1"><input name="${laite.id}-koodi" value="${laite.koodi}"></td>
                            <td class="laite_col2"><input name="${laite.id}-nimi" value="${laite.nimi}"></td>
                            <td class="laite_col3"><input name="${laite.id}-hinta" value="${laite.hinta}"></td>
                            <td class="laite_col4"><input name="${laite.id}-maara" value="${laite.maara}"></td>
                            <td class="laite_col5"><input name="${laite.id}-yksikko" value="${laite.yksikko}"></td>
                            <td class="laite_col6"><input name="${laite.id}-A" type="checkbox" checked="${'checked' if 'A' in laite.tyyppi else None}"></td>
                            <td class="laite_col7"><input name="${laite.id}-T" type="checkbox" checked="${'checked' if 'T' in laite.tyyppi else None}"></td>
                        </tr>
                        <a name="tavarat"></a>
                        <tr>
                            <td class="tavara_col1"><input name="n1-koodi"></td>
                            <td class="tavara_col2"><input name="n1-nimi"></td>
                            <td class="tavara_col3"><input name="n1-hinta"></td>
                            <td class="tavara_col4"><input name="n1-maara"></td>
                            <td class="tavara_col5"><input name="n1-yksikko" value="kpl"></td>
                            <td class="tavara_col6"><input name="n1-A" type="checkbox"></td>
                            <td class="tavara_col7"><input name="n1-T" type="checkbox"></td>
                        </tr>
                        <tr>
                            <td class="tavara_col1"><input name="n2-koodi"></td>
                            <td class="tavara_col2"><input name="n2-nimi"></td>
                            <td class="tavara_col3"><input name="n2-hinta"></td>
                            <td class="tavara_col4"><input name="n2-maara"></td>
                            <td class="tavara_col5"><input name="n2-yksikko" value="kpl"></td>
                            <td class="tavara_col6"><input name="n2-A" type="checkbox"></td>
                            <td class="tavara_col7"><input name="n2-T" type="checkbox"></td>
                        </tr>
                        <tr>
                            <td class="tavara_col1"><input name="n3-koodi"></td>
                            <td class="tavara_col2"><input name="n3-nimi"></td>
                            <td class="tavara_col3"><input name="n3-hinta"></td>
                            <td class="tavara_col4"><input name="n3-maara"></td>
                            <td class="tavara_col5"><input name="n3-yksikko" value="kpl"></td>
                            <td class="tavara_col6"><input name="n3-A" type="checkbox"></td>
                            <td class="tavara_col7"><input name="n3-T" type="checkbox"></td>
                        </tr>
                        <tr>
                            <td colspan="6">
                                <button class="save_button">Tallenna</button>
                            </td>
                        </tr>
                    </table>
                </form>
            </div>
        </div>
    </metal:main>
</metal:main>